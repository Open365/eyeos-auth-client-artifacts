(function(){define("src/settings",[],function(){return{storage:"LocalStorage",authServiceUrl:window.document.location.protocol+"//"+window.document.domain+"/login/v1/methods/",renewDefaultCardTimeout:7200,temporaryExpireCardTime:60}}),define("src/orderedStringify",[],function(){var e=function(n,r){var s=[],u="{";for(var a in n)s.push(a);s=s.sort(r);for(var a=0;a<s.length;a++){var f=n[s[a]],l=i[o(f)];l===3?f=e(f,r):l===2?f=t(f,r):l===1&&(f='"'+f+'"'),l!==4&&(u+='"'+s[a]+'":'+f+",")}return u.substring(u,u.lastIndexOf(","))+"}"},t=function(n,r){var s="[";for(var u=0;u<n.length;u++){var a=n[u],f=i[o(a)];f===3?a=e(a,r):f===2?a=t(a):f===1&&(a='"'+a+'"'),f!==4&&(s+=""+a+",")}return s[s.length-1]==","&&(s=s.substr(0,s.length-1)),s+"]"},n=function(e,t){var s=[],u={};for(var a in e)s.push(a);s=s.sort(t);for(var a=0;a<s.length;a++){var f=e[s[a]],l=i[o(f)];l===3?f=n(f,t):l===2&&(f=r(f,t)),u[s[a]]=f}return u},r=function(e,t){for(var s=0;s<e.length;s++){var u=e[s],a=i[o(u)];a===3?u=n(u,t):a===2&&(u=r(u,t)),e[s]=u}return e},i={integer:0,"float":0,string:1,array:2,object:3,"function":4,regexp:5,date:6,"null":7,"undefined":8,"boolean":9},s=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},o=function(e){if(e===undefined)return"undefined";if(e===null)return"null";var t=typeof e;return t==="object"&&(t=s(e).toLowerCase()),t==="number"?e.toString().indexOf(".")>0?"float":"integer":t};return e}),define("src/storage/localStorageProvider",["src/orderedStringify"],function(e){var t=function(){};return t.prototype.get=function(e){var t=localStorage.getItem(e);try{t=JSON.parse(t)}catch(n){}return t},t.prototype.getRaw=function(e){var t=localStorage.getItem(e);return t},t.prototype.set=function(t,n){typeof n=="object"&&(n=e(n)),localStorage.setItem(t,n)},t.prototype.removeItem=function(e){localStorage.removeItem(e)},t}),define("src/storage/sessionStorageProvider",["src/orderedStringify"],function(e){var t=function(){};return t.prototype.get=function(e){var t=sessionStorage.getItem(e);try{t=JSON.parse(t)}catch(n){}return t},t.prototype.getRaw=function(e){var t=sessionStorage.getItem(e);return t},t.prototype.set=function(t,n){typeof n=="object"&&(n=e(n)),sessionStorage.setItem(t,n)},t.prototype.removeItem=function(e){sessionStorage.removeItem(e)},t}),define("src/storage/storageFactory",["src/storage/localStorageProvider","src/storage/sessionStorageProvider"],function(e,t){var n={getInstance:function(n){switch(n){case"LocalStorage":return new e;case"SessionStorage":return new t;default:throw new Error("Unknown storage provider: "+n)}}};return n}),define("src/storage/urlCredentials",[],function(){var e=function(e){this.hash=e||document.location.hash};return e.prototype.get=function(e){return this._getParameterByName(e)},e.prototype.clear=function(){document.location.hash="",this.hash=""},e.prototype.hasCredentials=function(){return this._getParameterByName("card")&&this._getParameterByName("signature")?!0:!1},e.prototype._getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\#&]"+e+"=([^&]*)"),n=t.exec(this.hash);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))},e}),define("src/credentials/credentialsManager",["src/settings","src/storage/storageFactory","src/storage/urlCredentials"],function(e,t,n){var r=function(r,i){this.storageProvider=r||t.getInstance(e.storage),this.urlCredentials=i||new n};return r.prototype.getCredentials=function(){this.urlCredentials.hasCredentials()&&(this.storageProvider.set("card",this.urlCredentials.get("card")),this.storageProvider.set("signature",this.urlCredentials.get("signature")),this.urlCredentials.clear());var e=this.storageProvider.get("card"),t=this.storageProvider.get("signature");if(e&&t)return{card:e,signature:t}},r.prototype.getRawCredentials=function(){var e=this.storageProvider.getRaw("card"),t=this.storageProvider.getRaw("minicard"),n=this.storageProvider.getRaw("signature"),r=this.storageProvider.getRaw("minisignature");if(e&&n)return{card:e,signature:n,minicard:t,minisignature:r}},r.prototype.getUsername=function(){var e=this.storageProvider.get("card");return!e||!e.username?!1:e.username},r.prototype.setCredentials=function(e){if(!e)throw new TypeError("Undefined credentials");if(!e.card||!e.signature)throw new TypeError("Can't set invalid Credentials");this.storageProvider.set("card",e.card),this.storageProvider.set("signature",e.signature),this.storageProvider.set("minicard",e.minicard),this.storageProvider.set("minisignature",e.minisignature)},r.prototype.getRenewCardTime=function(){return this.storageProvider.get("card").renewCardAt*1e3},r.prototype.removeRenewCardTime=function(){this.storageProvider.removeItem("renewCardTime")},r.prototype.removeCredentials=function(){this.storageProvider.removeItem("card"),this.storageProvider.removeItem("minicard"),this.storageProvider.removeItem("signature"),this.storageProvider.removeItem("minisignature"),this.storageProvider.removeItem("renewCardTime")},r}),define("src/credentials/renewCardAsyncHandler",[],function(){var e=function(e,t){this.cardRenewer=e||new e,this.credentialsManager=t||new t};return e.prototype.success=function(e){e=JSON.parse(e),this.credentialsManager.setCredentials(e),postal.publish({topic:"cardRenewed",data:e}),this.cardRenewer.scheduleRenew()},e.prototype.error=function(e){},e}),define("src/credentials/cardRenewer",["src/settings","src/credentials/credentialsManager","src/credentials/renewCardAsyncHandler"],function(e,t,n){var r=function(e,r,i){this.authService=e,this.credentialsManager=r||new t,this.renewCardAsyncHandler=i||new n(this,this.credentialsManager),this.timeout=null};return r.prototype.scheduleRenew=function(){var e=this,t=this.credentialsManager.getRenewCardTime(),n=t-Date.now();clearTimeout(this.timeout),this.timeout=setTimeout(function(){e.doRenew()},n)},r.prototype.doRenew=function(){var e=this.credentialsManager.getCredentials();this.authService.renewCard(e,this.renewCardAsyncHandler)},r}),define("src/headersManager",[],function(){var e=function(){};return e.prototype.prepareForAjax=function(e){for(var t in e)typeof e[t]=="object"&&(e[t]=JSON.stringify(e[t]));return e},e}),define("src/authService",["src/settings","src/credentials/cardRenewer","src/headersManager"],function(e,t,n){var r=function(e,r,i){this.cardRenewer=e||new t(this),this.headersManager=r||new n,this.$=i||$};return r.prototype.checkCard=function(t,n,r){t=this.headersManager.prepareForAjax(t),this.$.ajax({type:"POST",url:e.authServiceUrl+"checkCard/",headers:t,contentType:"application/json",success:this._scheduleRenewGenerator(n),error:r})},r.prototype.renewCard=function(t,n){t=this.headersManager.prepareForAjax(t),this.$.ajax({type:"POST",url:e.authServiceUrl+"renewCard/",headers:t,contentType:"application/json",success:n.success.bind(n),error:n.error})},r.prototype.doRenew=function(){this.cardRenewer.doRenew()},r.prototype._scheduleRenewGenerator=function(e){var t=this;return function(n){t.cardRenewer.scheduleRenew(),e(n)}},r}),define("src/eyeosAuthClient",["src/credentials/credentialsManager","src/authService"],function(e,t){var n=function(n,r){this.credentialsManager=n||new e,this.authService=r||new t};return n.prototype.getHeaders=function(){return this.credentialsManager.getCredentials()},n.prototype.getRawCredentials=function(){return this.credentialsManager.getRawCredentials()},n.prototype.getUsername=function(){return this.credentialsManager.getUsername()},n.prototype.checkCard=function(e,t){var n=this.credentialsManager.getCredentials();n?this.authService.checkCard(n,e,t):t()},n.prototype.removeCard=function(){this.credentialsManager.removeCredentials()},n.prototype.setToken=function(e){this.credentialsManager.removeRenewCardTime(),this.credentialsManager.setCredentials(e)},n.prototype.doRenew=function(){this.authService.doRenew()},n}),define(["src/eyeosAuthClient"],function(e){return window.eyeosAuthClient=new e,window.eyeosAuthClient})})();